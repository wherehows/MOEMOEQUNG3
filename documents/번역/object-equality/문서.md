---
date: '2023-03-12'
title: 'equality ë°©ë²• ë¹„êµí•˜ê¸°'
subTitle: 'equality ë°©ë²• ë¹„êµí•˜ê¸°'
grandParent: ''
parent: 'ETC'
slug: '/etc/object-equality'
---

ë³¸ì¸ì€ ì§€ê¸ˆê¹Œì§€ ì–´ë–¤ ë‘ ê°ì²´ë¥¼ ë¹„êµí•˜ê¸° ìœ„í•´ì„œ JSON.stringifyë¥¼ ì¨ì™”ë‹¤. ê·¸ëŸ¬ë‹¤ê°€ lodashë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ isEqualì„ ì œê³µí•œë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆì—ˆëŠ”ë°, ë¬¸ë“ JSON.stringify í•´ì£¼ë©´ ëë‚˜ëŠ” ê²ƒì„ ì™œ ë³„ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•˜ë©´ì„œê¹Œì§€ ê°ì²´ë¥¼ ë¹„êµí•´ì•¼í•˜ë‚˜ ì‹¶ì–´ì„œ ë¦¬ì„œì¹˜í•˜ì—¬ ì •ë¦¬í–ˆë‹¤. 

---

## JSON.stringifyì˜ ë¬¸ì œì 

JSON.stringifyê°€ ê°–ëŠ” ë¬¸ì œì ì€ ë‹¤ìŒ ì½”ë“œë“¤ì²˜ëŸ¼ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ë¡œê¹… ê²°ê³¼ë¡œë¶€í„° ì•Œìˆ˜ìˆë‹¤.

```typescript
console.log(JSON.stringify({ a:1, b:2 }) === JSON.stringify({ b:2, a:1 })); // false
console.log(JSON.stringify(NaN) === JSON.stringify((null))) // true
```

ë”ë¶ˆì–´ì„œ ë‹¤ìŒ ì½”ë“œì™€ ê°™ì´, ìˆœí™˜ ì°¸ì¡°í•˜ëŠ” ê°ì²´ì— ëŒ€í•´ì„œ ì½˜ì†”ì„ ì°ì–´ë³´ë©´ "Uncaught ReferenceError: Cannot access 'a' before initialization" ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

```typescript
const a = {
  b: a,
}

console.log(JSON.stringify(a)); // Uncaught ReferenceError: Cannot access 'a' before initialization
```
---

## `===` Equality, Shallow Eqaulity, Deep Equality ë¹„êµ

ë‘ ê°ì²´ì˜ ë™ì¼í•¨ì„ íŒë‹¨í•˜ê¸°ìœ„í•œ ë°©ë²•ìœ¼ë¡œ JSON.stringifyë¥¼ ì´ìš©í•œ ë°©ë²•, Shallow Equalityë¥¼ ì´ìš©í•œ ë°©ë²•, Deep Eqaulityë¥¼ ì´ìš©í•œ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤. JSON.stringifyëŠ” ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ë¹„êµí•˜ëŠ” ë°©ë²•ì´ë‹¤.

ê·¸ë ‡ë‹¤ë©´ Shallow Equalityì™€ Deep EqualityëŠ” ë¬´ì—‡ì¼ê¹Œ? ë‹¤ìŒ ì˜ˆì‹œë“¤ì„ í†µí•´ì„œ ì•Œì•„ë³´ì.

```typescript
const user1 = {
  name: "John",
  address: {
      line1: "55 Green Park Road",
      line2: "Purple Valley"  
  }
};

const user2 = user1;

console.log(user1 === user2); // true
console.log(shallowEqual(user1, user2)); // true
console.log(deepEqual(user1, user2)); // true
```

ìœ„ ì½”ë“œì—ì„œ `===`ëŠ” reference equalityë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤. user1ê³¼ user2ëŠ” ë™ì¼í•œ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ê¸° ë•Œë¬¸ì— trueë¥¼ ì¶œë ¥í•œë‹¤. ë§Œì•½ ë‹¤ìŒê³¼ ê°™ì´ user2ì— ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ í• ë‹¹í•œë‹¤ë©´ falseê°€ ì¶œë ¥ë˜ê²Œëœë‹¤.

```javascript
const user2 = {
  name: "John",
  address: user1.address,
}

console.log(user1 === user2); // false
console.log(shallowEqual(user1, user2)); // true
console.log(deepEqual(user1, user2)); // true
```

ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  shallowEqualì€ ì—¬ì „íˆ trueë¥¼ ì¶œë ¥í•´ë‚¸ë‹¤. shallowEqualì€ í”„ë¡œí¼í‹° í•˜ë‚˜í•˜ë‚˜ì— ëŒ€í•´ì„œ `===`ì„ ì ìš©í•˜ê¸° ë•Œë¬¸ì—, user2ì˜ address referenceê°€ ë™ì¼í•¨ìœ¼ë¡œ trueë¥¼ ì¶œë ¥í•˜ëŠ” ê²ƒì´ë‹¤. ë§Œì•½ ë‹¤ìŒê³¼ ê°™ì´ user2ì˜ address í”„ë¡œí¼í‹°ì— ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ê°’ì„ í• ë‹¹í•œë‹¤ë©´, ê²°ê³¼ëŠ” falseê°€ ë‚˜ì˜¤ê²Œ ë ê²ƒì´ë‹¤.

```javascript
const user2 = {
  name: "John",
  address: {
      line1: "55 Green Park Road",
      line2: "Purple Valley"  
  }
}

console.log(user1 === user2); // false
console.log(shallowEqual(user1, user2)); // false
console.log(deepEqual(user1, user2)); // true
```

ì§€ê¸ˆê¹Œì§€ user2ë¥¼ ë‹¤ì–‘í•˜ê²Œ ìˆ˜ì •í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  deepEqualì€ ê³„ì†í•´ì„œ trueë¥¼ ì¶œë ¥í•˜ê³  ìˆë‹¤. ì´ìœ ëŠ” deep Equalì´ í”„ë¡œí¼í‹° ë‚´ë¶€ë¥¼ ì „ë¶€ ë¹„êµí•˜ê¸° ë•Œë¬¸ì´ë‹¤.

---

## Shallow Equalityì™€ Deep EqualityëŠ” ì–´ë–»ê²Œ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ?

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ë¹„êµë¥¼ ìœ„í•´ì„œ `==`, `===`ì—°ì‚°ìì™€ `Object.is` ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ë¹„êµë¥¼ í•œë‹¤. ê·¸ë ‡ë‹¤ë©´ ë‘ ë³€ìˆ˜ë¥¼ `ê¹Šê²Œ(deeply)` ë¹„êµí•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

`==` ì—°ì‚°ìëŠ” ê°’ì„ ë¹„êµí•˜ê¸°ì— ì•ì„œ ë™ì¼í•œ íƒ€ì…ì„ ê°–ë„ë¡ ë³€í™˜í•œ í›„ ë¹„êµë¥¼ ì§„í–‰í•˜ëŠ”, êµ‰ì¥íˆ ëŠìŠ¨í•œ ë¹„êµ(loose eqaulity operator)ì—°ì‚°ìë‹¤. `===`ì—°ì‚°ìëŠ” `==`ì—°ì‚°ìì™€ëŠ” ë‹¤ë¥´ê²Œ íƒ€ì… ë³€í™˜ ê³¼ì • ì—†ì´ ë¹„êµë¥¼ ì§„í–‰í•˜ëŠ” ì—„ê²©í•œ ë¹„êµ(strict equaility operator)ì—°ì‚°ìë‹¤. í•˜ì§€ë§Œ `===`ì—°ì‚°ìë„ ë‹¤ìŒê³¼ ê°™ì€ í—ˆì ì´ ì¡´ì¬í•œë‹¤.

```typescript
console.log(+0 === -0); // true
console.log(NaN === NaN); // false
```

`Object.is`ëŠ” ëŒ€ë¶€ë¶„ì˜ ê²½ìš° `===`ì—°ì‚°ìì™€ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ì§€ë§Œ, ì•ì„  ë‘ ì¼€ì´ìŠ¤ì™€ëŠ” ë°˜ëŒ€ë˜ëŠ”, ì˜¬ë°”ë¥¸ ê²°ê³¼ë¥¼ ë‚´ë†“ëŠ”ë‹¤.

```typescript
console.log(Object.is(+0, -0)); // false
console.log(Object.is(NaN, NaN)); // true
```

ë‹¤ë§Œ ì´ê²ƒì´ `Object.is`ê°€ `===`ë³´ë‹¤ ë” ì—„ê²©í•˜ê²Œ ë¹„êµí•œë‹¤ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ìƒí™©ì— ë”°ë¼ì„œ ë‘˜ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ëœë‹¤.

Deep Eqaulì€ ì—¬ëŸ¬ê°€ì§€ edge caseë¥¼ ê³ ë ¤í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì´ ëŠë¦´ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ Reactì—ì„œëŠ” ìƒíƒœ ë³€í™” ë¹„êµë¥¼ ìœ„í•´ Shallow Equalì„ ì´ìš©í•œë‹¤. Shallow Equalì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„ë  ìˆ˜ ìˆë‹¤.

```typescript
import is from './objectIs';
import hasOwnProperty from './hasOwnProperty';

function shallowEqual(objA: mixed, objB: mixed): boolean {
  // P1
  if (is(objA, objB)) {
    return true;
  }

  // P2
  if (
    typeof objA !== 'object' ||
    objA === null ||
    typeof objB !== 'object' ||
    objB === null
  ) {
    return false;
  }

  const keysA = Object.keys(objA);
  const keysB = Object.keys(objB);

  // P3
  if (keysA.length !== keysB.length) {
    return false;
  }

  // P4
  for (let i = 0; i < keysA.length; i++) {
    const currentKey = keysA[i];
    if (
      !hasOwnProperty.call(objB, currentKey) ||
      !is(objA[currentKey], objB[currentKey])
    ) {
      return false;
    }
  }

  return true;
};
```

- P1ì€ `===` ì—°ì‚°ìœ¼ë¡œ ë¹„êµí•˜ì—¬ ë™ì¼í•˜ë©´ trueë¥¼ returní•œë‹¤
- P2ëŠ” ì´í›„ ë¡œì§ì„ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ ê°ì²´ê°€ ì•„ë‹Œ ê²½ìš°ë¥¼ returní•œë‹¤
- P3ì€ í‚¤ë“¤ì˜ ê°œìˆ˜ê°€ ë‹¤ë¥¸ ê²½ìš° falseë¥¼ returní•œë‹¤
- P4ëŠ” ë³¸ê²©ì ìœ¼ë¡œ í”„ë¡œí¼í‹°ë¥¼ í•˜ë‚˜í•˜ë‚˜ ë¹„êµí•˜ë©° ê°’ì´ ê°ì²´ì¸ ê²½ìš° ì¬ê·€ì ìœ¼ë¡œ ë¹„êµí•œë‹¤.

ê·¸ë¦¬ê³  Deep Equalì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„ëœë‹¤.

```typescript
const deepEqual = (objA, objB, map = new WeakMap()) => {
  // P1
  if (Object.is(objA, objB)) return true;

  // P2
  if (objA instanceof Date && objB instanceof Date) {
    return objA.getTime() === objB.getTime();
  }
  if (objA instanceof RegExp && objB instanceof RegExp) {
    return objA.toString() === objB.toString();
  }

  // P3
  if (
    typeof objA !== 'object' ||
    objA === null ||
    typeof objB !== 'object' ||
    objB === null
  ) {
    return false;
  }

  // P4
  if (map.get(objA) === objB) return true;
  map.set(objA, objB);

  // P5
  const keysA = Reflect.ownKeys(objA);
  const keysB = Reflect.ownKeys(objB);

  // P6
  if (keysA.length !== keysB.length) {
    return false;
  }

  // P7
  for (let i = 0; i < keysA.length; i++) {
    if (
      !Reflect.has(objB, keysA[i]) ||
      !deepEqual(objA[keysA[i]], objB[keysA[i]], map)
    ) {
      return false;
    }
  }

  return true;
};
```

- P1, P3, P6, P7ì€ Shallow Eqaulê³¼ ë™ì¼í•˜ë‹¤.
- P2ì—ì„œ Dateì™€ RegExpì˜ ê²½ìš°ì˜ ë¹„êµë¥¼ ì§„í–‰í•œë‹¤.
- P4ì—ì„œ ìˆœí™˜ ì°¸ì¡°ì¸ ê²½ìš° trueë¥¼ ë°˜í™˜í•œë‹¤.
- P5ì—ì„œëŠ” Shallow Equalê³¼ëŠ” ë‹¤ë¥´ê²Œ Object.keysë¡œ í‚¤ë¥¼ ì–»ëŠ”ê²Œ ì•„ë‹ˆë¼, Reflect.ownKeysë¡œ í‚¤ë“¤ì„ ì–»ëŠ”ë‹¤.

Reflectì™€ WeakMapì— ëŒ€í•´ì„œëŠ” ì„¤ëª…ì„ ê±´ë„ˆë›°ê² ë‹¤. ê¶ê¸ˆí•˜ë‹¤ë©´ [Reflect](https://javascript.info/proxy)ì™€ [WeakMap](https://javascript.info/weakmap-weakset)ì„ ì°¸ê³ í•˜ì

## ğŸ“š ì°¸ê³ ë¬¸í—Œ

[JavaScript deep object comparison - JSON.stringify vs deepEqual](https://www.mattzeunert.com/2016/01/28/javascript-deep-equal.html)

[Is it fine to use JSON.stringify for deep comparisons and cloning?](https://stackoverflow.com/questions/15376185/is-it-fine-to-use-json-stringify-for-deep-comparisons-and-cloning)

[How to Get a Perfect Deep Equal in JavaScript?](https://levelup.gitconnected.com/how-to-get-a-perfect-deep-equal-in-javascript-b849fe30e54f)
