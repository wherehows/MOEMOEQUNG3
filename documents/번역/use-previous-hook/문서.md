---
date: '2023-03-12'
title: 'usePrevious ì¡°ê¸ˆ ë” ê¹Šê²Œ ì´í•´í•˜ê¸°'
subTitle: 'usePrevious ì¡°ê¸ˆ ë” ê¹Šê²Œ ì´í•´í•˜ê¸°'
parent: 'ETC'
slug: '/etc/use-previous-hook'
---

usePrevious í›…ì„ ê²€ìƒ‰í•´ë³´ë©´ ë³´í†µ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±ëœë‹¤.

```typescript
// usePrevious.ts
export default function usePrevious(value) {
  const ref = useRef();

  useEffect(() => {
    ref.current = value;
  }, [value]);

  return ref.current;
}
```

ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ importí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```typescript
// App.tsx
function App() {
  const [count, setCount] = useState(0);

  const prevCount = usePrevious(count);

  useEffect(() => {
    console.log(count, prevCount);
  }, [count, prevCount]);

  return (
    <div>
      <h1>
        Now: {count}
        <br />
        Before: {prevCount}
      </h1>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}
```

[ì½”ë“œ ì¶œì²˜](https://codesandbox.io/s/pwnl6v7z6m)

App ì»´í¬ë„ŒíŠ¸ ë‚´ì˜ useEffect ë‚´ë¶€ì—ì„œ countì™€ prevCountì— ëŒ€í•´ì„œ ì½˜ì†”ì„ ì°ì–´ë³´ë©´ prevCountëŠ” countì˜ í•­ìƒ ì´ì „ ê°’ì„ ë³´ì—¬ì¤€ë‹¤. ì´ì™€ ê´€ë ¨í•˜ì—¬ ì´í•´ê°€ ì•ˆê°€ëŠ” ë¶€ë¶„ì´ ì¡´ì¬í–ˆë‹¤.

ë‚´ê°€ ìƒê°í•œ ê²ƒì€ ë‹¤ìŒê³¼ ê°™ë‹¤. useEffect ë‚´ë¶€ì˜ ë¡œì§ì€ ë Œë”ë§ì´ ë°œìƒí•œ í›„ì— ì‹¤í–‰ëœë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ref.currentê°€ ë°”ë€ŒëŠ” ê²ƒë„ ë Œë”ë§ì´ ëœ í›„ì´ë‹¤. ë”ë¶ˆì–´ì„œ App ì»´í¬ë„ŒíŠ¸ì˜ useEffect ë‚´ prevCountëŠ” ì´ë¯¸ ê°’ì´ ë°”ë€Œì–´ ìˆìœ¼ë¯€ë¡œ ì½˜ì†”ì„ ì°ì—ˆì„ ë•Œ countì™€ prevCountê°€ ê°™ì€ ê°’ì„ ê°€ì ¸ì•¼ í•œë‹¤. ë¼ëŠ”ê²Œ ë‚´ ìƒê°ì´ì—ˆë‹¤. í•˜ì§€ë§Œ ê·¸ë ‡ì§€ ì•Šë‹¤.

ë‹µì€ ë‹¤ìŒ í• ë‹¹ë¬¸ì— ì¡´ì¬í–ˆë‹¤.

```javascript
const prevCount = usePrevious(count);
```

useEffect ë‚´ì—ì„œ countì™€ prevCountê°€ ë™ì¼í•œ ê°’ì„ ê°–ì§€ ì•ŠëŠ” ì´ìœ ëŠ”, ì´ì „ ê°’ì„ ì ‘ê·¼í•  ë•Œ ref.currentë¥¼ í†µí•´ì„œ ì ‘ê·¼í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ prevCountë¥¼ í†µí•´ì„œ ì ‘ê·¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ref.currentê°’ì´ ë°”ë€Œê¸° ì „ì—ëŠ” countì˜ ì´ì „ ê°’ì„ ê°€ì§€ê³  ìˆë‹¤. ì´ ê°’ì„ ìš°ì„  prevCountì— í• ë‹¹í•˜ê³ , ë Œë”ë§ì´ ëë‚˜ë©´ ref.currentë¥¼ countì˜ ìµœì‹ ê°’ì— ì—…ë°ì´íŠ¸í•¨ìœ¼ë¡œì¨ useEffect ë‚´ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

---

## usePrevious ê°•í™”í•˜ê¸°

ì•ì„  usePrevious í›…ì€ í•œ ê°€ì§€ ë¬¸ì œì ì„ ì•ˆê³ ìˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ App ì½”ë“œê°€ ì‘ì„±ë¼ ìˆë‹¤ê³  ê°€ì •í•´ë³´ì

```typescript
function App() {
  const [count, setCount] = useState(0);
  const [_, forceRerender] = useState({});

  const prevCount = usePrevious(count);

  useEffect(() => {
    console.log(count, prevCount);
  }, [count, prevCount]);

  return (
    <div>
      <button onClick={() => forceRerender({})}>force rerender</button>
      <button onClick={() => setCount(count + 1)}>Increment</button>
    </div>
  );
}
```

Increment ë²„íŠ¼ì„ ì„¸ë²ˆ ëˆ„ë¥´ë©´ useEffect ë‚´ì˜ countì™€ prevCountëŠ” ì–´ë–¤ ê°’ì´ ì°íê¹Œ? ê°ê° 3ê³¼ 2ê°€ ì°í ê²ƒì´ë‹¤. ì´ ìƒíƒœì—ì„œ ë§Œì•½ force rerender ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ useEffect ë‚´ì—ì„œëŠ” ì–´ë–¤ ê°’ì´ ì°íê¹Œ? 3ê³¼ 3ì´ ì°íŒë‹¤. count ìƒíƒœê°€ ë³€í•˜ì§€ ì•Šì•˜ìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , prevCountê°€ countê°’ê³¼ ë™ì¼í•´ì§€ëŠ” ê²ƒì´ë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ usePreviousë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.

```javascript
export const usePreviousPersistent = <TValue extends unknown>(
  value: TValue
) => {
  // P1
  const ref = useRef<{ value: TValue; prev: TValue | null }>({
    value: value,
    prev: null
  });

  // P2
  const current = ref.current.value;

  // P3
  if (value !== current) {
    ref.current = {
      value: value,
      prev: current
    };
  }

  // P4
  return ref.current.prev;
};
```

ì£¼ì„ì„ ë”°ë¼ì„œ ì„¤ëª…í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

- (P1) ê¸°ì¡´ì˜ usePrevious í›…ê³¼ëŠ” ë‹¤ë¥´ê²Œ ref ë‚´ì— ì´ì „ ê°’ì„ ì €ì¥í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼, ì´ì „ ê°’ê³¼ í˜„ì¬ ê°’ì„ í”„ë¡œí¼í‹°ë¡œ ê°–ëŠ” ê°ì²´ë¥¼ ì €ì¥í•œë‹¤. usePreviousëŠ” í•­ìƒ prev í”„ë¡œí¼í‹° ê°’ì„ ë°˜í™˜í•œë‹¤.
- (P2) refê°€ ì €ì¥í•˜ëŠ” ê°ì²´ì˜ í˜„ì¬ ê°’ì¸ valueë¥¼ curentì— í• ë‹¹í•œë‹¤.
- (P3) ì¸ìë¡œ ì „ë‹¬ë˜ëŠ” valueì™€ current(refê°€ ê¸°ì¡´ì— ê¸°ì–µí•˜ê³  ìˆë˜ value)ê°€ ë‹¤ë¥´ë‹¤ë©´, refê°€ ê´€ì°°í•˜ëŠ” ìƒíƒœê°€ ì—…ë°ì´íŠ¸ ëœ ê²ƒì´ë¯€ë¡œ, refê°€ ê¸°ì¡´ì— ê¸°ì–µí•˜ê³  ìˆë˜ valueëŠ” ì´ì „ ê°’ì´ ë˜ë¯€ë¡œ prev í”„ë¡œí¼í‹°ì— í• ë‹¹í•˜ê³ , ìƒˆë¡œ ê¸°ì–µí•´ì•¼ í•˜ëŠ” valueëŠ” value í”„ë¡œí¼í‹°ì— í• ë‹¹í•œë‹¤.

ë§Œì•½ ê°ì²´ë¥¼ ë¹„êµí•´ì•¼ í•˜ëŠ” ê²½ìš° deep equalityë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ ê¸€ì“´ì´ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë”°ë¼ì„œ ì†ë„ê°€ ëŠë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë³„ë¡œ ì„ í˜¸í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•œë‹¤. ê·¸ë˜ì„œ matcher í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ë‹¤ìŒ ë°©ì‹ì„ ì œì•ˆí•˜ê³  ìˆë‹¤.

```javascript
export const usePreviousPersistentWithMatcher = <TValue extends unknown>(
  value: TValue,
  isEqualFunc: (prev: TValue, next: TValue) => boolean
) => {
  const ref = useRef<{ value: TValue; prev: TValue | null }>({
    value: value,
    prev: null
  });

  const current = ref.current.value;

  if (isEqualFunc ? !isEqualFunc(current, value) : value !== current) {
    ref.current = {
      value: value,
      prev: current
    };
  }

  return ref.current.prev;
};
```

## ğŸ“š ì°¸ê³ ë¬¸í—Œ

[Implementing advanced usePrevious hook with React useRef](https://www.developerway.com/posts/implementing-advanced-use-previous-hook)
